{
    "Resources": {
        "sfourdevsns": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "DisplayName": "stonewallin-sfour-dev-bucket-notifier",
                "Tags": [
                    {
                        "Key": "project",
                        "Value": "sfour"
                    },
                    {
                        "Key": "environment",
                        "Value": "dev"
                    }
                ],
                "TopicName": "stonewallin-sfour-dev-bucket-notifier"
            }
        },
		"sfourdevsnsPolicy": {
		  "Type": "AWS::SNS::TopicPolicy",
		  "Properties": {
			"Topics": [
			  { "Ref": "sfourdevsns" }
			],
			"PolicyDocument": {
			  "Version": "2012-10-17",
			  "Statement": [
				{
				  "Effect": "Allow",
				  "Principal": {
					"Service": "s3.amazonaws.com"
				  },
				  "Action": "sns:Publish",
				  "Resource": { "Ref": "sfourdevsns" },
				  "Condition": {
					"ArnLike": {
					  "aws:SourceArn": {
						"Fn::Sub": "arn:aws:s3:::stonewall-sfour-dev"
					  }
					}
				  }
				}
			  ]
			}
		  }
		},
		"sfourdevsqs": {
			  "Type" : "AWS::SQS::Queue",
			  "Properties" : {
				  "DelaySeconds" : 0,
				  "MaximumMessageSize" : 262144,
				  "MessageRetentionPeriod" : 345600,
				  "QueueName" : "stonewallin-sfour-dev-bucket-queue",
				  "ReceiveMessageWaitTimeSeconds" : 5,
				  "Tags" : [
						{
							"Key": "project",
							"Value": "sfour"
						},
						{
							"Key": "environment",
							"Value": "dev"
						}
					],
				  "VisibilityTimeout" : 300
				}
		},
		"sfourdevsqssub": {
			"Type" : "AWS::SNS::Subscription",
			"Properties" : {
				"Endpoint" : { "Fn::GetAtt": [ "sfourdevsqs", "Arn" ] },
				"Protocol" : "sqs",
				"RawMessageDelivery" : false,
				"TopicArn" : { "Ref" :  "sfourdevsns" }
			}
		},
        "sfourdevbucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": "stonewall-sfour-dev",
                "AccessControl": "BucketOwnerFullControl",
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "LifecycleConfiguration": {
                    "Rules": [
                        {
                            "Id": "PermanentlyDeleteRule60",
                            "Prefix": "test-data",
                            "Status": "Enabled",
                            "ExpirationInDays": 60
                        }
                    ]
                },
                "NotificationConfiguration": {
                    "TopicConfigurations": [
                        {
                            "Topic": {
                                "Ref": "sfourdevsns"
                            },
                            "Event": "s3:ObjectCreated:*"
                        }
                    ]
                },
                "OwnershipControls": {
                    "Rules": [
                        {
                            "ObjectOwnership": "BucketOwnerPreferred"
                        }
                    ]
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "RestrictPublicBuckets": true
                },
                "Tags": [
                    {
                        "Key": "project",
                        "Value": "sfour"
                    },
                    {
                        "Key": "environment",
                        "Value": "dev"
                    }
                ]
            }
        }
    }
}